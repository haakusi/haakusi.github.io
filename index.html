<!DOCTYPE html>
<html data-theme="dark" data-lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sewon Park</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">‚òÄÔ∏è</button>
    <button class="lang-toggle" onclick="toggleLanguage()" aria-label="Toggle language">EN</button>
    
    <div class="container">
        <header>
            <h1 data-en="Sewon Park" data-kr="Î∞ïÏÑ∏Ïõê">Sewon Park</h1>
            <p class="subtitle" data-en="Senior Research Engineer | AI & Full-Stack Development" data-kr="ÏÑ†ÏûÑ Ïó∞Íµ¨Ïõê | AI Î∞è ÌíÄÏä§ÌÉù Í∞úÎ∞ú">Senior Research Engineer | AI & Full-Stack Development</p>
            <div class="social-links">
                <a href="mailto:haakusi@gmail.com" aria-label="Email">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="4" width="20" height="16" rx="2"/>
                        <path d="m22 7-10 5L2 7"/>
                    </svg>
                </a>
                <a href="https://github.com/haakusi" target="_blank" aria-label="GitHub">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
                <a href="https://www.linkedin.com/in/sewon-p-38009a1a7/" target="_blank" aria-label="LinkedIn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                    </svg>
                </a>
                <a href="https://twitter.com/haakusi_" target="_blank" aria-label="X (Twitter)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
            </div>
        </header>

        <nav class="navigation">
            <a href="index.html" class="nav-link active" data-en="Home" data-kr="Ìôà">Home</a>
            <a href="blog.html" class="nav-link" data-en="Blog" data-kr="Î∏îÎ°úÍ∑∏">Blog</a>
            <a href="cv.html" class="nav-link" data-en="CV" data-kr="Ïù¥Î†•ÏÑú">CV</a>
        </nav>

        <section class="about">
            <h2 data-en="About" data-kr="ÏÜåÍ∞ú">About</h2>
            <p data-en="AI Engineer & Full-Stack Developer with 7+ years of experience building enterprise solutions. Specializing in LLM-based applications, multi-agent systems, and MCP (Model Context Protocol) development. Currently architecting intelligent automation systems at Suprema Inc." 
               data-kr="7ÎÖÑ Ïù¥ÏÉÅÏùò Í≤ΩÌóòÏùÑ Í∞ÄÏßÑ AI ÏóîÏßÄÎãàÏñ¥Ïù¥Ïûê ÌíÄÏä§ÌÉù Í∞úÎ∞úÏûêÎ°ú ÏóîÌÑ∞ÌîÑÎùºÏù¥Ï¶à ÏÜîÎ£®ÏÖòÏùÑ Íµ¨Ï∂ïÌïòÍ≥† ÏûàÏäµÎãàÎã§. LLM Í∏∞Î∞ò Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò, Î©ÄÌã∞ ÏóêÏù¥Ï†ÑÌä∏ ÏãúÏä§ÌÖú, MCP(Model Context Protocol) Í∞úÎ∞úÏùÑ ÏßÑÌñâÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÌòÑÏû¨ ÏäàÌîÑÎ¶¨ÎßàÏóêÏÑú ÏßÄÎä•Ìòï ÏûêÎèôÌôî ÏãúÏä§ÌÖúÏùÑ ÏÑ§Í≥ÑÌïòÍ≥† ÏûàÏäµÎãàÎã§.">AI Engineer & Full-Stack Developer with 7+ years of experience building enterprise solutions. Specializing in LLM-based applications, multi-agent systems, and MCP (Model Context Protocol) development. Currently architecting intelligent automation systems at Suprema Inc.</p>
        </section>

        <section class="interests">
            <h2 data-en="Interests" data-kr="Í¥ÄÏã¨ÏÇ¨">Interests</h2>
            <p data-en="Actively exploring Programming Massively Parallel Processors and the mathematical foundations of LLM architectures, examining computational complexity theory, optimization landscapes, and emergent behaviors in large-scale neural systems. Passionate about advancing the theoretical understanding of how quantum computing can fundamentally transform machine learning paradigms."
               data-kr="ÎåÄÍ∑úÎ™® Î≥ëÎ†¨ ÌîÑÎ°úÏÑ∏ÏÑú ÌîÑÎ°úÍ∑∏ÎûòÎ∞çÍ≥º LLM ÏïÑÌÇ§ÌÖçÏ≤òÏùò ÏàòÌïôÏ†Å Í∏∞Î∞òÏùÑ Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú ÌÉêÍµ¨ÌïòÎ©∞, Í≥ÑÏÇ∞ Î≥µÏû°ÏÑ± Ïù¥Î°†, ÏµúÏ†ÅÌôî, Í∑∏Î¶¨Í≥† ÎåÄÍ∑úÎ™® Ïã†Í≤ΩÎßù ÏãúÏä§ÌÖúÏùÑ Ïó∞Íµ¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÏñëÏûê Ïª¥Ìì®ÌåÖÏù¥ Î®∏Ïã†Îü¨Îãù Ìå®Îü¨Îã§ÏûÑÏùÑ Í∑ºÎ≥∏Ï†ÅÏúºÎ°ú Î≥ÄÌôîÏãúÌÇ¨ Ïàò ÏûàÎäî Î∞©Î≤ïÏóê ÎåÄÌïú Ïù¥Î°†Ï†Å Ïù¥Ìï¥Î•º Î∞úÏ†ÑÏãúÌÇ§Îäî Îç∞ Ïó¥Ï†ïÍ≥º Í¥ÄÏã¨ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏäµÎãàÎã§.">Actively exploring Programming Massively Parallel Processors and the mathematical foundations of LLM architectures, examining computational complexity theory, optimization landscapes, and emergent behaviors in large-scale neural systems. Passionate about advancing the theoretical understanding of how quantum computing can fundamentally transform machine learning paradigms.</p>
        </section>

        <section class="recently">
            <h2 data-en="Recently" data-kr="ÏµúÍ∑º">Recently</h2>
            <p data-en="Research interests lie at the fundamental intersection of quantum computation and financial modeling. Investigating the theoretical foundations of Quantum Machine Learning (QML) and Quantum Neural Networks (QNN) for financial market dynamics prediction, with focus on quantum advantage in complex financial pattern recognition. Academic publications exploring quantum-classical hybrid architectures currently in preparation."
               data-kr="Ïó∞Íµ¨ Í¥ÄÏã¨ÏÇ¨Îäî ÏñëÏûê Ïª¥Ìì®ÌåÖÍ≥º Í∏àÏúµ Î™®Îç∏ÎßÅÏùò Í∑ºÎ≥∏Ï†ÅÏù∏ Î∂ÄÎ∂ÑÎì§Ïóê ÏûàÏäµÎãàÎã§. Î≥µÏû°Ìïú Í∏àÏúµ Ìå®ÌÑ¥ Ïù∏ÏãùÏóêÏÑú ÏñëÏûê Ïö∞ÏúÑÏóê Ï¥àÏ†êÏùÑ ÎßûÏ∂∞ Í∏àÏúµ ÏãúÏû• Ïó≠Ìïô ÏòàÏ∏°ÏùÑ ÏúÑÌïú ÏñëÏûê Î®∏Ïã†Îü¨Îãù(QML)Í≥º ÏñëÏûê Ïã†Í≤ΩÎßù(QNN)Ïùò Ïù¥Î°†Ï†Å Í∏∞Î∞òÏùÑ Ïó∞Íµ¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÏñëÏûê-Í≥†Ï†Ñ ÌïòÏù¥Î∏åÎ¶¨Îìú ÏïÑÌÇ§ÌÖçÏ≤òÎ•º ÌÉêÍµ¨ÌïòÎäî ÌïôÏà† ÎÖºÎ¨∏ÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.">Research interests lie at the fundamental intersection of quantum computation and financial modeling. Investigating the theoretical foundations of Quantum Machine Learning (QML) and Quantum Neural Networks (QNN) for financial market dynamics prediction, with focus on quantum advantage in complex financial pattern recognition. Academic publications exploring quantum-classical hybrid architectures currently in preparation.</p>
        </section>

        <section class="visitor-stats">
            <h2 data-en="Visitor Statistics" data-kr="Î∞©Î¨∏Ïûê ÌÜµÍ≥Ñ">Visitor Statistics</h2>
            <div class="visitor-content">
                <div class="visitor-map">
                    <div id="world-map"></div>
                </div>
                <div class="visitor-info">
                    <div class="visitor-counter">
                        <h3 data-en="Total Visits" data-kr="Ï¥ù Î∞©Î¨∏ Ïàò">Total Visits</h3>
                        <div class="counter-display">
                            <span id="visitor-count">0</span>
                        </div>
                        <div class="unique-counter">
                            <small data-en="Unique Visitors: " data-kr="Ïàú Î∞©Î¨∏Ïûê: ">Unique Visitors: </small>
                            <span id="unique-count">0</span>
                        </div>
                    </div>
                    <div class="country-stats">
                        <h3 data-en="Visitors by Country" data-kr="Íµ≠Í∞ÄÎ≥Ñ Î∞©Î¨∏Ïûê">Visitors by Country</h3>
                        <div id="country-list"></div>
                    </div>
                </div>
            </div>
        </section>


        <footer>
            <p>Last updated: August 2025</p>
        </footer>
    </div>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update button icon
            const button = document.querySelector('.theme-toggle');
            button.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleLanguage() {
            const html = document.documentElement;
            const currentLang = html.getAttribute('data-lang') || 'en';
            const newLang = currentLang === 'en' ? 'kr' : 'en';
            
            html.setAttribute('data-lang', newLang);
            localStorage.setItem('language', newLang);
            
            // Update button text
            const button = document.querySelector('.lang-toggle');
            button.textContent = newLang === 'en' ? 'EN' : 'Ìïú';
            
            // Update content
            updateContent(newLang);
        }

        function updateContent(lang) {
            const elements = document.querySelectorAll('[data-en][data-kr]');
            elements.forEach(element => {
                if (lang === 'kr' && element.getAttribute('data-kr')) {
                    element.textContent = element.getAttribute('data-kr');
                } else if (lang === 'en' && element.getAttribute('data-en')) {
                    element.textContent = element.getAttribute('data-en');
                }
            });
        }

        // Load saved theme and language on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeButton = document.querySelector('.theme-toggle');
            themeButton.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            
            const savedLang = localStorage.getItem('language') || 'en'; // Default to English
            document.documentElement.setAttribute('data-lang', 'en'); // Force English default
            
            const langButton = document.querySelector('.lang-toggle');
            langButton.textContent = 'EN'; // Default to EN
            
            updateContent('en'); // Force English content
            
            // Initialize visitor tracking
            initializeVisitorTracking();
            
            // Auto-refresh visitor data every 30 seconds for real-time updates
            setInterval(async () => {
                await loadAndDisplayVisitorData();
            }, 30000); // 30 seconds
            
            // Refresh data when page regains focus (user comes back to tab)
            window.addEventListener('focus', async () => {
                await loadAndDisplayVisitorData();
            });
            
            // Refresh data when page becomes visible (tab switching)
            document.addEventListener('visibilitychange', async () => {
                if (!document.hidden) {
                    await loadAndDisplayVisitorData();
                }
            });
        });


        // Google Sheets as database - your shared sheet for visitor tracking
        const SHEET_ID = '1gwAK8MgiOqEE9RK8rXT3QN4zRoTPLEeGjpHTDmXCwIA';
        const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;
        // Google Apps Script webhook URL - your deployed script
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby6glhA3zFkI_FRNHojfGMTwWUN28f_D4nnIYY5zma9ifXZm4YDzEY8bOVbwSYea-2t3A/exec';
        
        // Visitor tracking functionality with GitHub Gist storage
        async function initializeVisitorTracking() {
            // Initialize world map first - always show
            initializeWorldMap();
            
            // Load existing data from Google Sheets first
            await loadAndDisplayVisitorData();
            
            try {
                // Try multiple IP services as fallback
                let data = null;
                
                // Try ipinfo.io first
                try {
                    const response = await fetch('https://ipinfo.io/json');
                    if (response.ok) {
                        const ipData = await response.json();
                        
                        // Get full country name from code
                        const countryNames = {
                            'KR': 'South Korea',
                            'US': 'United States',
                            'JP': 'Japan',
                            'CN': 'China',
                            'GB': 'United Kingdom',
                            'DE': 'Germany',
                            'FR': 'France',
                            'IN': 'India',
                            'BR': 'Brazil',
                            'CA': 'Canada',
                            'AU': 'Australia'
                        };
                        
                        data = {
                            country_name: countryNames[ipData.country] || ipData.country,
                            country_code: ipData.country
                        };
                    }
                } catch (e) {
                }
                
                // If no data yet, try geojs.io (better for Asia)
                if (!data) {
                    try {
                        const response = await fetch('https://get.geojs.io/v1/ip/country.json');
                        if (response.ok) {
                            const ipData = await response.json();
                            data = {
                                country_name: ipData.name,
                                country_code: ipData.country
                            };
                        }
                    } catch (e) {
                    }
                }
                
                // If we got location data, update visitor count
                if (data) {
                    const country = data.country_name || 'Unknown';
                    const countryCode = data.country_code || 'XX';
                    
                    // Update visitor count with Google Sheets integration
                    await updateVisitorCountWithGoogleSheets(country, countryCode);
                } else {
                    // Fallback - just count as unknown visitor
                    await updateVisitorCountWithGoogleSheets('Unknown', 'XX');
                }
                
            } catch (error) {
                // Still count the visit even if location detection fails
                await updateVisitorCountWithGoogleSheets('Unknown', 'XX');
            }
        }
        
        // Load visitor data from Google Sheets CSV - with bulletproof counter protection
        async function loadAndDisplayVisitorData() {
            try {
                const globalData = await loadGlobalVisitorData();
                
                // ÌòÑÏû¨ ÌôîÎ©¥Ïóê ÌëúÏãúÎêú Ïà´ÏûêÎì§ÏùÑ Ï†àÎåÄ Í∏∞Ï§ÄÏúºÎ°ú ÏÇ¨Ïö©
                const currentTotalElement = document.getElementById('visitor-count');
                const currentUniqueElement = document.getElementById('unique-count');
                const currentTotal = parseInt(currentTotalElement.textContent) || 0;
                const currentUnique = parseInt(currentUniqueElement.textContent) || 0;
                
                // Î°úÏª¨ Ï†ÄÏû•ÏÜåÏùò Ïã§Ï†ú Î∞©Î¨∏Ïûê Îç∞Ïù¥ÌÑ∞ÎèÑ ÌôïÏù∏
                const localData = JSON.parse(localStorage.getItem('realVisitorData')) || { totalVisits: 0, uniqueVisitors: 0 };
                
                // ÏÑ∏ Í∞í Ï§ë Í∞ÄÏû• ÎÜíÏùÄ Í∞íÏùÑ ÏÇ¨Ïö© (ÌôîÎ©¥ ÌëúÏãú, Î°úÏª¨ Ï†ÄÏû•ÏÜå, Google Sheets)
                const safeTotal = Math.max(currentTotal, localData.totalVisits, globalData.totalVisits || 0);
                const safeUnique = Math.max(currentUnique, localData.uniqueVisitors, globalData.uniqueVisitors || 0);
                
                // Ï†àÎåÄ Í∞êÏÜå Í∏àÏßÄ: ÌòÑÏû¨ ÌëúÏãúÎêú Í∞íÎ≥¥Îã§ ÎÜíÏùÑ ÎïåÎßå ÏóÖÎç∞Ïù¥Ìä∏
                if (safeTotal > currentTotal) {
                    currentTotalElement.textContent = safeTotal;
                }
                if (safeUnique > currentUnique) {
                    currentUniqueElement.textContent = safeUnique;
                }
                
                // ÏïàÏ†ÑÌïú Îç∞Ïù¥ÌÑ∞Î•º Ï∫êÏãúÏóê Ï†ÄÏû• (Ìï≠ÏÉÅ Ï¶ùÍ∞ÄÎßå ÌïòÎäî Í∞í)
                const safeData = {
                    totalVisits: safeTotal,
                    uniqueVisitors: safeUnique,
                    countries: globalData.countries || {},
                    lastUpdate: new Date().toISOString()
                };
                localStorage.setItem('cachedVisitorData', JSON.stringify(safeData));
                
                // Íµ≠Í∞Ä Î™©Î°ùÍ≥º ÏßÄÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                updateCountryList(globalData.countries || {});
                
                if (worldMap) {
                    setTimeout(() => {
                        addVisitorDots();
                    }, 500);
                }
                
                return safeData;
                
            } catch (e) {
                // ÏóêÎü¨ ÏãúÏóêÎäî Ï†àÎåÄ ÌôîÎ©¥ÏùÑ Í±¥ÎìúÎ¶¨ÏßÄ ÏïäÏùå
                return {};
            }
        }
        
        // Update visitor count with Google Sheets integration
        async function updateVisitorCountWithGoogleSheets(country, countryCode) {
            try {
                // Create session ID if new visitor
                let sessionId = sessionStorage.getItem('visitorSessionId');
                if (!sessionId) {
                    sessionId = Date.now().toString() + '-' + Math.random().toString(36).substr(2, 9);
                    sessionStorage.setItem('visitorSessionId', sessionId);
                }
                
                // Load existing local data first
                let globalData = JSON.parse(localStorage.getItem('realVisitorData')) || {
                    totalVisits: 0,
                    uniqueVisitors: 0,
                    countries: {},
                    lastUpdate: new Date().toISOString()
                };
                
                // Always increment total visits
                globalData.totalVisits++;
                
                // Check if this is a new unique visitor session
                if (!sessionStorage.getItem('visitorSessionId-counted')) {
                    globalData.uniqueVisitors++;
                    sessionStorage.setItem('visitorSessionId-counted', 'true');
                }
                
                // Update country count
                if (globalData.countries[countryCode]) {
                    globalData.countries[countryCode].count++;
                } else {
                    globalData.countries[countryCode] = {
                        name: country,
                        count: 1
                    };
                }
                
                globalData.lastUpdate = new Date().toISOString();
                
                // Save real visitor data locally
                localStorage.setItem('realVisitorData', JSON.stringify(globalData));
                localStorage.setItem('cachedVisitorData', JSON.stringify(globalData));
                
                // Send visitor data to Google Sheets
                
                // Send to Google Apps Script
                try {
                    await addToGoogleSheets(country, countryCode, sessionId);
                } catch (error) {
                    // Silent error handling
                }
                
                // Update local display (ensure numbers never go backwards)
                const currentTotal = parseInt(document.getElementById('visitor-count').textContent) || 0;
                const currentUnique = parseInt(document.getElementById('unique-count').textContent) || 0;
                
                document.getElementById('visitor-count').textContent = Math.max(globalData.totalVisits, currentTotal);
                document.getElementById('unique-count').textContent = Math.max(globalData.uniqueVisitors, currentUnique);
                updateCountryList(globalData.countries);
                
                // Refresh the map dots
                if (worldMap) {
                    setTimeout(() => {
                        addVisitorDots();
                    }, 500);
                }
                
                return globalData;
                
            } catch (error) {
                // Fallback to original localStorage method
                return updateVisitorCount(country, countryCode);
            }
        }
        
        // Load visitor data from Google Sheets CSV
        async function loadGlobalVisitorData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                if (response.ok) {
                    const csvText = await response.text();
                    const lines = csvText.split('\n').filter(line => line.trim());
                    
                    // Check if sheet is empty or has only header
                    if (lines.length <= 1) {
                        return getDemoVisitorData();
                    }
                    
                    // Skip header row if exists
                    const dataLines = lines.slice(1);
                    
                    let totalVisits = dataLines.length;
                    let uniqueVisitors = 0;
                    let countries = {};
                    let sessionIds = new Set();
                    
                    // Process each row
                    dataLines.forEach(line => {
                        const [timestamp, country, countryCode, sessionId] = line.split(',').map(cell => cell.replace(/"/g, ''));
                        
                        if (sessionId && !sessionIds.has(sessionId)) {
                            sessionIds.add(sessionId);
                            uniqueVisitors++;
                        }
                        
                        if (countryCode && countryCode !== 'XX') {
                            if (countries[countryCode]) {
                                countries[countryCode].count++;
                            } else {
                                countries[countryCode] = {
                                    name: country || 'Unknown',
                                    count: 1
                                };
                            }
                        }
                    });
                    
                    const data = {
                        totalVisits: totalVisits,
                        uniqueVisitors: uniqueVisitors,
                        countries: countries,
                        lastUpdate: new Date().toISOString()
                    };
                    
                    localStorage.setItem('cachedVisitorData', JSON.stringify(data));
                    return data;
                }
            } catch (e) {
                // Silent error handling
            }
            
            // Return cached or demo data
            const cached = localStorage.getItem('cachedVisitorData');
            if (cached) {
                return JSON.parse(cached);
            }
            
            return getDemoVisitorData();
        }
        
        // Add comprehensive visitor data to Google Sheets using Google Apps Script
        async function addToGoogleSheets(country, countryCode, sessionId) {
            const timestamp = new Date().toISOString();
            
            // Ìè¨Í¥ÑÏ†ÅÏù∏ Î∞©Î¨∏Ïûê Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const visitorData = {
                timestamp: timestamp,
                country: country,
                countryCode: countryCode,
                sessionId: sessionId,
                // Î∏åÎùºÏö∞Ï†Ä Ï†ïÎ≥¥
                userAgent: navigator.userAgent,
                language: navigator.language || navigator.userLanguage,
                platform: navigator.platform,
                // ÌôîÎ©¥ Ï†ïÎ≥¥
                screenWidth: screen.width,
                screenHeight: screen.height,
                screenColorDepth: screen.colorDepth,
                // Î∑∞Ìè¨Ìä∏ Ï†ïÎ≥¥
                viewportWidth: window.innerWidth,
                viewportHeight: window.innerHeight,
                // ÏãúÍ∞ÑÎåÄ Ï†ïÎ≥¥
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timezoneOffset: new Date().getTimezoneOffset(),
                // Ïú†ÏûÖ Í≤ΩÎ°ú
                referrer: document.referrer || 'Direct',
                // ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥
                pageUrl: window.location.href,
                pageTitle: document.title,
                // Ïó∞Í≤∞ Ï†ïÎ≥¥ (ÏßÄÏõêÎêòÎäî Í≤ΩÏö∞)
                connectionType: navigator.connection ? navigator.connection.effectiveType : 'Unknown',
                // ÌÑ∞Ïπò ÏßÄÏõê Ïó¨Î∂Ä
                touchSupport: 'ontouchstart' in window,
                // Ïø†ÌÇ§ ÏßÄÏõê Ïó¨Î∂Ä
                cookieEnabled: navigator.cookieEnabled
            };
            
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Required for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(visitorData)
                });
                
                return true;
                
            } catch (error) {
                throw error;
            }
        }
        
        // Get safe visitor data that never decreases
        function getDemoVisitorData() {
            // Check if we have any existing count displayed
            const currentTotalElement = document.getElementById('visitor-count');
            const currentUniqueElement = document.getElementById('unique-count');
            const currentTotal = parseInt(currentTotalElement?.textContent) || 0;
            const currentUnique = parseInt(currentUniqueElement?.textContent) || 0;
            
            const demoData = {
                totalVisits: Math.max(0, currentTotal), // Never go below current display
                uniqueVisitors: Math.max(0, currentUnique),
                countries: {},
                lastUpdate: new Date().toISOString()
            };
            
            localStorage.setItem('cachedVisitorData', JSON.stringify(demoData));
            return demoData;
        }
        
        
        // Save global visitor data
        async function saveGlobalVisitorData(data) {
            try {
                // Save countries to localStorage
                localStorage.setItem('globalCountries', JSON.stringify(data.countries));
                localStorage.setItem('cachedVisitorData', JSON.stringify(data));
                return true;
            } catch (e) {
                return false;
            }
        }

        function updateVisitorCount(country, countryCode) {
            // Get existing visitor data from localStorage
            let visitorData = JSON.parse(localStorage.getItem('visitorData')) || {
                totalVisits: 0,
                uniqueVisitors: 0,
                countries: {},
                lastVisit: null,
                visitorId: null
            };
            
            // Check if this is a new unique visitor
            const sessionId = sessionStorage.getItem('visitorSessionId');
            if (!sessionId) {
                // New session - increment unique visitors
                sessionStorage.setItem('visitorSessionId', Date.now().toString());
                visitorData.uniqueVisitors = (visitorData.uniqueVisitors || 0) + 1;
            }
            
            // Update country count
            if (visitorData.countries[countryCode]) {
                visitorData.countries[countryCode].count++;
            } else {
                visitorData.countries[countryCode] = {
                    name: country,
                    count: 1
                };
            }
            
            // Always increment total visits
            visitorData.totalVisits++;
            visitorData.lastVisit = new Date().toISOString();
            
            // Save updated data
            localStorage.setItem('visitorData', JSON.stringify(visitorData));
            
            // Update display with total visits (all visits from this browser)
            document.getElementById('visitor-count').textContent = visitorData.totalVisits;
            document.getElementById('unique-count').textContent = visitorData.uniqueVisitors;
            updateCountryList(visitorData.countries);
            
            // Refresh the map dots with delay
            if (worldMap) {
                setTimeout(() => {
                    addVisitorDots();
                }, 500);
            }
        }

        function updateCountryList(countries) {
            const countryList = document.getElementById('country-list');
            const sortedCountries = Object.entries(countries)
                .sort(([,a], [,b]) => b.count - a.count);
            
            const totalCountries = sortedCountries.length;
            const showAll = totalCountries <= 10;
            const displayCountries = showAll ? sortedCountries : sortedCountries.slice(0, 8);
            
            let html = displayCountries.map(([code, data]) => 
                `<div class="country-item">
                    <span class="country-flag">${getFlagEmoji(code)}</span>
                    <span class="country-name">${data.name}</span>
                    <span class="country-count">${data.count}</span>
                </div>`
            ).join('');
            
            // If more than 10 countries, show summary
            if (!showAll) {
                const remainingCount = totalCountries - 8;
                html += `<div class="country-item country-more">
                    <span class="country-flag">üåç</span>
                    <span class="country-name">+${remainingCount} more countries</span>
                    <span class="country-count">...</span>
                </div>`;
            }
            
            countryList.innerHTML = html;
        }

        function getFlagEmoji(countryCode) {
            const codePoints = countryCode
                .toUpperCase()
                .split('')
                .map(char => 127397 + char.charCodeAt());
            return String.fromCodePoint(...codePoints);
        }

        let worldMap = null;
        let visitorMarkers = [];

        function initializeWorldMap(centerCountryCode = null) {
            try {
                const mapContainer = document.getElementById('world-map');
                
                if (!mapContainer) {
                    return;
                }
                
                // Clear any existing map
                if (worldMap) {
                    worldMap.remove();
                    worldMap = null;
                }
                
                // Initialize Leaflet map - Korea positioned with zoom 1.5
                worldMap = L.map('world-map', {
                    zoomControl: false  // Remove +/- buttons
                }).setView([37, 140], 1.5); // Korea latitude, zoom 1.5 for best view
                
                // Add OpenStreetMap tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ''
                }).addTo(worldMap);
                
                // Disable all interactions for static map
                worldMap.dragging.disable();
                worldMap.touchZoom.disable();
                worldMap.doubleClickZoom.disable();
                worldMap.scrollWheelZoom.disable();
                worldMap.boxZoom.disable();
                worldMap.keyboard.disable();
                if (worldMap.tap) worldMap.tap.disable();
                
                // Add visitor markers when ready
                worldMap.whenReady(function() {
                    // Clear all existing visitor data for fresh start
                    localStorage.removeItem('visitorData');
                    sessionStorage.removeItem('visitorSessionId');
                    
                    // Reset display counters
                    document.getElementById('visitor-count').textContent = '0';
                    document.getElementById('unique-count').textContent = '0';
                    document.getElementById('country-list').innerHTML = '';
                    
                    // Start fresh visitor tracking
                    addVisitorDots();
                });
                
            } catch (error) {
                // Silent error handling
            }
        }

        function getCountryCoordinates() {
            // Real geographical coordinates (latitude, longitude)
            return {
                // Unknown location - hide marker off screen
                'XX': [-90, -180], // Hide unknown visitors off map
                
                // North America
                'US': [39.8283, -98.5795], 'CA': [56.1304, -106.3468], 'MX': [23.6345, -102.5528],
                
                // South America  
                'BR': [-14.2350, -51.9253], 'AR': [-38.4161, -63.6167], 'CO': [4.5709, -74.2973], 
                'PE': [-9.1900, -75.0152], 'CL': [-35.6751, -71.5430], 'VE': [6.4238, -66.5897], 
                'UY': [-32.5228, -55.7658],
                
                // Europe
                'GB': [55.3781, -3.4360], 'FR': [46.6034, 1.8883], 'DE': [51.1657, 10.4515], 
                'IT': [41.8719, 12.5674], 'ES': [40.4637, -3.7492], 'NL': [52.1326, 5.2913], 
                'SE': [60.1282, 18.6435], 'NO': [60.4720, 8.4689], 'PL': [51.9194, 19.1451], 
                'RU': [61.5240, 105.3188], 'PT': [39.3999, -8.2245], 'CH': [46.8182, 8.2275],
                'AT': [47.5162, 14.5501], 'BE': [50.5039, 4.4699], 'DK': [56.2639, 9.5018], 
                'FI': [61.9241, 25.7482], 'IE': [53.1424, -7.6921], 'CZ': [49.8175, 15.4730], 
                'HU': [47.1625, 19.5033],
                
                // Africa
                'ZA': [-30.5595, 22.9375], 'NG': [9.0820, 8.6753], 'EG': [26.0975, 31.1351], 
                'KE': [-0.0236, 37.9062], 'MA': [31.7917, -7.0926], 'ET': [9.1450, 40.4897], 
                'DZ': [28.0339, 1.6596], 'LY': [26.3351, 17.2283], 'GH': [7.9465, -1.0232], 
                'TN': [33.8869, 9.5375],
                
                // Asia
                'CN': [35.8617, 104.1954], 'IN': [20.5937, 78.9629], 'JP': [36.2048, 138.2529], 
                'KR': [37.5665, 126.9780], 'TH': [15.8700, 100.9925], 'VN': [14.0583, 108.2772], // Seoul coordinates for Korea 
                'ID': [-0.7893, 113.9213], 'MY': [4.2105, 101.9758], 'PH': [12.8797, 121.7740], 
                'SG': [1.3521, 103.8198], 'TR': [38.9637, 35.2433], 'IR': [32.4279, 53.6880], 
                'SA': [23.8859, 45.0792], 'AE': [23.4241, 53.8478], 'IL': [31.0461, 34.8516], 
                'PK': [30.3753, 69.3451], 'BD': [23.6850, 90.3563], 'MM': [21.9162, 95.9560], 
                'LK': [7.8731, 80.7718], 'AF': [33.9391, 67.7100], 'IQ': [33.2232, 43.6793], 
                'SY': [34.8021, 38.9968], 'JO': [30.5852, 36.2384], 'LB': [33.8547, 35.8623],
                'KW': [29.3117, 47.4818], 'QA': [25.3548, 51.1839], 'OM': [21.4735, 55.9754], 
                'YE': [15.5527, 48.5164],
                
                // Oceania
                'AU': [-25.2744, 133.7751], 'NZ': [-40.9006, 174.8860], 'PG': [-6.3150, 143.9555], 
                'FJ': [-16.5780, 179.4144]
            };
        }

        function addVisitorDots() {
            if (!worldMap) {
                return;
            }
            
            // Use cached visitor data from Google Sheets only
            let globalData = JSON.parse(localStorage.getItem('cachedVisitorData')) || {};
            let countries = globalData.countries || {};
            
            // Clear existing visitor markers
            visitorMarkers.forEach(marker => worldMap.removeLayer(marker));
            visitorMarkers = [];
            
            // Get country coordinates
            const countryCoords = getCountryCoordinates();
            
            if (Object.keys(countries).length === 0) {
                return;
            }
            
            // Add marker for each visited country using basic L.marker (like the working black lighthouse)
            Object.entries(countries).forEach(([code, data]) => {
                const coords = countryCoords[code];
                if (coords && code !== 'XX') { // Skip unknown locations
                    const [lat, lng] = coords;
                    
                    // Create basic marker (same as working lighthouse markers)
                    const marker = L.marker([lat, lng]).addTo(worldMap);
                    visitorMarkers.push(marker);
                    
                    // Add popup with country info
                    marker.bindPopup(`
                        <div style="text-align: center; font-family: Georgia, serif; padding: 8px;">
                            <div style="font-size: 2.5em; margin-bottom: 8px;">${getFlagEmoji(code)}</div>
                            <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px; color: #333;">${data.name}</div>
                            <div style="color: #666; font-size: 1em;">${data.count} visit${data.count > 1 ? 's' : ''}</div>
                        </div>
                    `);
                }
            });
        }
    </script>
</body>
</html>